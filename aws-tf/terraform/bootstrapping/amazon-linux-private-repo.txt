#! /bin/bash
#
# PrivateGithubRepo:
# This user-data content runs as 'root'
# A git repository (private) is cloned to /app-infra and ownership set to ec2-user
# The folder context of user-data is /
#
yum update -y

yum install git -y

git clone https://${github_user_name}:${github_pat}@github.com/${github_user_name}/${github_repo_name}.git app-infra
history -c

cd /app-infra
git checkout ${github_commit}
git remote remove origin 

cd /app-infra/aws-tf/setup
chmod +x amazon-linux.sh
./amazon-linux.sh

chown -R ec2-user:ec2-user /app-infra

history -c
